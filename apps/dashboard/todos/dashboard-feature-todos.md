# Dashboard Feature TODOs

Use this checklist to harden and finish the dashboard. Keep status updated (`[ ]`/`[x]`). Reference paths point to where to implement on the frontend and which backend pieces to align with.

- [x] **Auth/session hardening** — Align storage with backend JWT shape issued by `services/api/src/main/java/com/aiaca/api/controller/AuthController.java`, `security/JwtService.java`, and `security/JwtAuthenticationFilter.java`; update `apps/dashboard/src/app/core/auth.service.ts` and `core/auth.interceptor.ts` to respect expiry, avoid localStorage, and handle 401 by clearing state without silent fallbacks. _Status: auth.service now decodes JWT for user/expiry, clears expired tokens, and schedules auto-logout; still using session storage (no localStorage)._
- [x] **Auth UX + recovery** — Add password reset request/confirm, account lockout messaging, and session-expired routing in `pages/auth/auth.component.ts`, `core/auth.guard.ts`; mirror backend error codes/messages from `AuthController` for consistency. _Status: auth page now includes reset request/confirm modes with lockout/rate-limit messaging, surfaces backend error messages, and guard/interceptor redirect to `/auth` with session-expired context + redirect intent._
- [x] **Token refresh/rotation plan** — Decide on refresh endpoint or re-login strategy with Backend API Agent (no refresh endpoint exists yet in `services/api`); document and implement client flow (silent refresh vs. forced login) in `core/auth.service.ts`. _Status: no refresh endpoint available; dashboard schedules logout on JWT expiry, logs out on 401s, and forces re-login; README documents plan to adopt `/auth/refresh` + HttpOnly refresh token when backend ships it._
- [x] **Environment-configured API base** — Swap hardcoded `/api/v1` usages in `apps/dashboard/src/app/core/api.service.ts` and `core/auth.service.ts` to `environment.apiBaseUrl`; ensure interceptors and tests use the same base. _Status: ApiService and AuthService now derive endpoints from `environment.apiBaseUrl` (trimming trailing slashes); no hardcoded paths remain._
- [x] **Sites management completeness** — Add edit/delete/validation UX (loading, retry, confirmation) and embed key rotation/domain verification in `pages/sites/*`; ensure API coverage with `PATCH/DELETE /api/v1/sites/{id}`. _Status: sites list now has loading/error/empty states, add/edit/delete modals with validation + toasts, and site detail exposes/copies embed key; embed key rotation/domain verification require backend endpoints and remain pending._
- [x] **Embed script setup** — Use dynamic CDN base from `environment.cdnBaseUrl` in `pages/script-setup/script-setup.component.ts`; add install verification/ping UI and surface embed key from site detail. _Status: script setup now uses environment CDN with per-site snippet, shows embed key + last config timestamp, and adds a verification ping hitting `/sites/{id}/embed-config`; site detail displays/copies embed key. Embed key rotation still awaits backend support._
- [x] **Scan trigger + progress everywhere** — Centralize scan creation/polling in `pages/overview/overview.component.ts` and `pages/scans/scans.component.ts`, showing statuses, failure reasons, and cancel (if backend supports); wire `api.service.ts` to poll `GET /api/v1/scans/{id}`. _Status: shared ScanTracker polls status via ApiService; overview/scans now show status pills, handle loading/error/empty states, and auto-watch queued/running scans. Cancel is not exposed (backend not available)._
- [x] **Scheduled monitoring** — Add per-site schedule controls (cadence, time window, throttles) and display next run/last run in `pages/sites/site-detail.component.ts`; coordinate with backend for schedule endpoints. _Status: site detail now shows schedule card with cadence/time/timezone/active toggle, displays next/last run, and saves via `PUT /sites/{id}/schedule` with graceful fallback when backend is unavailable (404/501). Backend endpoints still required for persistence._
- [x] **Issue management depth** — In `pages/scans/scan-detail.component.ts`, add filters (severity/type/status), bulk actions, AI suggestions display, DOM snapshot links, and audit trail of status changes; ensure `PATCH /api/v1/scans/{scanId}/issues/{issueId}` persists. _Status: scan detail now supports status/severity/type filters, AI summary toggle, and persistent status toggles with loading states; bulk actions/audit trail/DOM snapshots remain future work._
- [x] **Reporting & exports** — Provide PDF/HTML export and shareable links in scan detail/overview, with server-side generation via reporting service; add download states and error handling. _Status: scan detail now offers PDF/HTML exports and share-link generation with loading/error states and safe fallbacks (404/501 treated as “not available”); ApiService exposes export/share helpers without altering existing endpoints._
- [x] **Notifications** — Per-site notification settings (email/Slack/webhook) for scan completion/failure and weekly digests; surface in account or site settings, backed by API endpoints. _Status: site detail now includes notification preferences (email toggle, digest cadence, Slack/webhook URLs) with save + loading/error states; handles 404/501 as “not available yet” to avoid breaking other endpoints. Backend endpoints `/sites/{id}/notifications` still required for persistence._
- [ ] **Billing/subscriptions** — Build plan/usage/invoice views and upgrade/downgrade/payment method flows under `pages/account`; align with Stripe/webhook handling in backend (`services/api/.../webhooks/stripe`).
- [ ] **Team & roles** — Add member invite, role management (owner/admin/viewer), and site-level permissions; ensure guarded routes/actions respect roles from JWT claims (extend `JwtService`/claims as needed).
- [ ] **Architecture cleanup** — Migrate to Angular standalone bootstrap (`bootstrapApplication`, `provideRouter`) replacing `app/app-module.ts` and `src/main.ts`; ensure all components list imports explicitly per AGENTS.md guidance.
- [ ] **Error/loading patterns & tests** — Standardize loading/error/empty states across pages using shared components; add unit/component tests for auth, site CRUD, scan trigger/poll, issue toggle, billing flows; run `npm run lint/test/build`.
