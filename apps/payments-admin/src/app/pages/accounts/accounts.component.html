<a class="skip-link" href="#accounts-table">Skip to accounts table</a>

<section class="page-header">
  <div>
    <p class="eyebrow">Accounts</p>
    <h1>Manage buyers and entitlements</h1>
    <p class="lede">Search, filter, and audit every buyer. Click into details for subscriptions, invoices, and dunning.</p>
  </div>
  <div class="header-actions">
    <button class="btn btn-secondary" type="button" (click)="resetFilters()">Reset filters</button>
    <button class="btn btn-primary" type="button" (click)="bulkFlag()">
      Bulk actions ({{ selected().size }} selected)
    </button>
  </div>
</section>

<section class="filters">
  <label class="input-group">
    <span>Search</span>
    <input
      type="search"
      placeholder="Name or email"
      [(ngModel)]="filters.search"
      (ngModelChange)="applyFilter({ search: $event })"
    />
  </label>
  <label class="input-group">
    <span>Status</span>
    <select [(ngModel)]="filters.status" (ngModelChange)="applyFilter({ status: $event })">
      <option value="all">All</option>
      <option *ngFor="let status of statusOptions" [value]="status">{{ status }}</option>
    </select>
  </label>
  <label class="input-group">
    <span>Currency</span>
    <select [(ngModel)]="filters.currency" (ngModelChange)="applyFilter({ currency: $event })">
      <option value="all">Any</option>
      <option value="USD">USD</option>
      <option value="EUR">EUR</option>
      <option value="GBP">GBP</option>
    </select>
  </label>
  <div class="input-group">
    <span>Sort</span>
    <div class="sort-buttons">
      <button class="btn btn-ghost" type="button" (click)="changeSort('name')">Name</button>
      <button class="btn btn-ghost" type="button" (click)="changeSort('createdAt')">Created</button>
      <button class="btn btn-ghost" type="button" (click)="changeSort('status')">Status</button>
    </div>
  </div>
</section>

<section class="grid">
  <article class="panel">
    <header class="panel__header">
      <div>
        <p class="eyebrow">Buyer roster</p>
        <h3>Accounts connected to billing</h3>
      </div>
      <span class="badge">Live data</span>
    </header>

    <div class="table" id="accounts-table" *ngIf="displayAccounts$ | async as accounts">
      <div class="table__head accounts-head">
        <span>
          <input type="checkbox" aria-label="Select all" (change)="selectAll(accounts)" />
        </span>
        <span>Buyer</span>
        <span>Email</span>
        <span>Currency</span>
        <span>Status</span>
        <span>Created</span>
        <span>Actions</span>
      </div>

      <div class="table__row accounts-row" *ngFor="let account of accounts">
        <input
          type="checkbox"
          aria-label="Select account"
          [checked]="selected().has(account.id)"
          (change)="toggleSelection(account.id, $event.target.checked)"
        />
        <div>
          <a class="cell-title" [routerLink]="['/accounts', account.id]">{{ account.name }}</a>
          <p class="cell-sub">{{ account.id }}</p>
        </div>
        <span class="cell-sub">{{ account.primaryContactEmail || 'â€”' }}</span>
        <span class="pill">{{ account.currency }}</span>
        <span [ngClass]="badgeClass(account.status)">{{ account.status }}</span>
        <span>{{ account.createdAt | date: 'mediumDate' }}</span>
        <div class="actions">
          <button class="btn btn-ghost" type="button" (click)="updateStatus(account.id, AccountStatus.ACTIVE)">Mark active</button>
          <button class="btn btn-ghost" type="button" (click)="updateStatus(account.id, AccountStatus.DELINQUENT)">Mark delinquent</button>
          <a class="btn btn-secondary" [routerLink]="['/accounts', account.id]">View</a>
        </div>
      </div>

      <p class="empty" *ngIf="accounts.length === 0">No buyers match these filters yet.</p>
    </div>
  </article>

  <article class="panel form-card">
    <header class="panel__header">
      <div>
        <p class="eyebrow">New buyer</p>
        <h3>Add an account</h3>
      </div>
      <span class="badge">Onboard</span>
    </header>

    <form class="form" (ngSubmit)="createAccount()">
      <label class="input-group">
        <span>Buyer name</span>
        <input
          type="text"
          name="name"
          [ngModel]="newAccount().name"
          (ngModelChange)="setAccountName($event)"
          required
        />
      </label>

      <label class="input-group">
        <span>Billing email</span>
        <input
          type="email"
          name="email"
          [ngModel]="newAccount().primaryContactEmail"
          (ngModelChange)="setAccountEmail($event)"
        />
      </label>

      <label class="input-group">
        <span>Currency</span>
        <select
          name="currency"
          [ngModel]="newAccount().currency"
          (ngModelChange)="setAccountCurrency($event)"
        >
          <option value="USD">USD</option>
          <option value="EUR">EUR</option>
          <option value="GBP">GBP</option>
        </select>
      </label>

      <label class="input-group">
        <span>Status</span>
        <select
          name="status"
          [ngModel]="newAccount().status"
          (ngModelChange)="setAccountStatus($event)"
        >
          <option *ngFor="let status of statusOptions" [value]="status">{{ status }}</option>
        </select>
      </label>

      <label class="input-group checkbox">
        <input
          type="checkbox"
          name="taxExempt"
          [ngModel]="newAccount().taxExempt"
          (ngModelChange)="setAccountTaxExempt($event)"
        />
        <span>Tax exempt</span>
      </label>

      <button class="btn btn-primary" type="submit">Create buyer</button>
    </form>
  </article>
</section>
