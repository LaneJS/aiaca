{
  "version": 3,
  "sources": ["../src/lib/bootstrap.ts", "../src/lib/alt-text.ts", "../src/lib/constants.ts", "../src/lib/focus-outline.ts", "../src/lib/skip-link.ts", "../src/lib/script-loader.ts"],
  "sourcesContent": ["import { applyAltTextFixes } from './alt-text';\nimport { ensureFocusOutline } from './focus-outline';\nimport { injectSkipLink } from './skip-link';\nimport { fetchEmbedConfig, deriveFeatures, readScriptAttributes } from './script-loader';\nimport type { EmbedConfig } from './types';\n\nlet hasBootstrapped = false;\n\nasync function applyFixes(config: EmbedConfig | null): Promise<void> {\n  const attributes = readScriptAttributes();\n  if (!attributes) return;\n\n  const features = deriveFeatures(config, attributes);\n\n  if (features.altText) {\n    applyAltTextFixes(config?.altTextSuggestions);\n  }\n\n  if (features.skipLink) {\n    injectSkipLink({\n      text: config?.skipLinkText || attributes.skipLinkText,\n      targetSelector: config?.skipLinkTargetSelector,\n    });\n  }\n\n  if (features.focusOutline) {\n    ensureFocusOutline(attributes.focusOutlineColor || config?.focusOutlineColor);\n  }\n}\n\nexport async function bootstrap(): Promise<void> {\n  if (hasBootstrapped) return;\n  hasBootstrapped = true;\n\n  const attributes = readScriptAttributes();\n  if (!attributes) return;\n\n  const config = await fetchEmbedConfig(attributes);\n  await applyFixes(config);\n}\n\nif (typeof window !== 'undefined' && typeof document !== 'undefined') {\n  // eslint-disable-next-line @typescript-eslint/no-floating-promises\n  bootstrap();\n}\n", "import type { AltTextSuggestion } from './types';\n\nfunction matchesSuggestion(img: HTMLImageElement, suggestion: AltTextSuggestion): boolean {\n  if (suggestion.selector) {\n    try {\n      return img.matches(suggestion.selector);\n    } catch (error) {\n      console.warn('[AACA Embed] Invalid selector in alt text suggestion:', suggestion.selector, error);\n    }\n  }\n\n  if (suggestion.imageUrl) {\n    const imgSrc = img.currentSrc || img.src;\n    return Boolean(imgSrc) && imgSrc === suggestion.imageUrl;\n  }\n\n  return false;\n}\n\nexport function applyAltTextFixes(suggestions: AltTextSuggestion[] = []): void {\n  const targets = Array.from(\n    document.querySelectorAll('img:not([alt]), img[alt=\"\"], img[alt=\" \"]')\n  ) as HTMLImageElement[];\n\n  if (!targets.length || !suggestions.length) {\n    return;\n  }\n\n  targets.forEach((img) => {\n    const suggestion = suggestions.find((candidate) => matchesSuggestion(img, candidate));\n    if (suggestion) {\n      img.setAttribute('alt', suggestion.altText);\n    }\n  });\n}\n", "export const DEFAULT_API_BASE = '/api/v1';\nexport const DEFAULT_SKIP_LINK_TEXT = 'Skip to main content';\nexport const FOCUS_OUTLINE_COLOR = '#1f6feb';\nexport const STYLE_MARKER = 'data-aaca-embed-style';\nexport const SCRIPT_DATA_PREFIX = 'data-site-id';\n", "import { FOCUS_OUTLINE_COLOR, STYLE_MARKER } from './constants';\n\nexport function ensureFocusOutline(color?: string): void {\n  if (document.querySelector(`style[${STYLE_MARKER}=\"focus-outline\"]`)) {\n    return;\n  }\n\n  const style = document.createElement('style');\n  style.setAttribute(STYLE_MARKER, 'focus-outline');\n  const outlineColor = color || FOCUS_OUTLINE_COLOR;\n  style.textContent = `\n    :where(button, [role=\"button\"], a, input, select, textarea):focus-visible {\n      outline: 2px solid ${outlineColor} !important;\n      outline-offset: 2px;\n    }\n    :where(button, [role=\"button\"], a, input, select, textarea):focus {\n      outline: 2px solid ${outlineColor} !important;\n      outline-offset: 2px;\n    }\n  `;\n\n  document.head.appendChild(style);\n}\n", "import { DEFAULT_SKIP_LINK_TEXT, STYLE_MARKER } from './constants';\n\nfunction hasExistingSkipLink(): boolean {\n  const links = Array.from(document.querySelectorAll('a[href^=\"#\"]')) as HTMLAnchorElement[];\n  return links.some((link) => /skip/i.test(link.textContent || '') || link.dataset['aacaSkipLink'] !== undefined);\n}\n\nfunction ensureMainTarget(selector?: string): string {\n  if (selector) {\n    const target = document.querySelector(selector) as HTMLElement | null;\n    if (target) {\n      if (!target.id) {\n        target.id = 'aaca-main-content';\n      }\n      return `#${target.id}`;\n    }\n  }\n\n  const main = (document.querySelector('main') || document.querySelector('[role=\"main\"]')) as HTMLElement | null;\n  if (main) {\n    if (!main.id) {\n      main.id = 'aaca-main-content';\n    }\n    return `#${main.id}`;\n  }\n\n  return '#aaca-main-content';\n}\n\nfunction injectMainIfMissing(): void {\n  if (!document.getElementById('aaca-main-content')) {\n    const placeholder = document.createElement('div');\n    placeholder.id = 'aaca-main-content';\n    placeholder.setAttribute('role', 'main');\n    placeholder.setAttribute('aria-label', 'Main content');\n    placeholder.style.position = 'relative';\n    document.body.insertBefore(placeholder, document.body.firstChild);\n  }\n}\n\nexport function injectSkipLink(options: { text?: string; targetSelector?: string } = {}): void {\n  if (hasExistingSkipLink()) {\n    return;\n  }\n\n  const href = ensureMainTarget(options.targetSelector);\n  const link = document.createElement('a');\n  link.textContent = options.text || DEFAULT_SKIP_LINK_TEXT;\n  link.href = href;\n  link.dataset['aacaSkipLink'] = 'true';\n  link.className = 'aaca-skip-to-content';\n\n  const styles = document.createElement('style');\n  styles.setAttribute(STYLE_MARKER, 'skip-link');\n  styles.textContent = `\n    .aaca-skip-to-content {\n      position: absolute;\n      left: 8px;\n      top: -40px;\n      padding: 8px 12px;\n      background: #0f172a;\n      color: #ffffff;\n      z-index: 10000;\n      border-radius: 4px;\n      text-decoration: none;\n      transition: top 0.2s ease;\n    }\n    .aaca-skip-to-content:focus,\n    .aaca-skip-to-content:active {\n      top: 8px;\n      outline: 2px solid #ffffff;\n    }\n  `;\n\n  document.head.appendChild(styles);\n  document.body.insertBefore(link, document.body.firstChild);\n\n  if (href === '#aaca-main-content') {\n    injectMainIfMissing();\n  }\n}\n", "import { DEFAULT_API_BASE } from './constants';\nimport type { EmbedConfig, FeatureToggles, ScriptAttributes } from './types';\n\nconst DEFAULT_FEATURES: FeatureToggles = {\n  altText: true,\n  skipLink: true,\n  focusOutline: true,\n};\n\nfunction coerceBooleanFlag(value?: string): boolean | undefined {\n  if (value === undefined) return undefined;\n  return value === 'true' || value === '' || value === '1';\n}\n\nfunction findScriptElement(): HTMLScriptElement | null {\n  const current = document.currentScript;\n  if (current instanceof HTMLScriptElement) {\n    return current;\n  }\n\n  const scripts = Array.from(document.querySelectorAll('script')) as HTMLScriptElement[];\n  return scripts.find((node) => node.dataset['siteId'] !== undefined) ?? null;\n}\n\nexport function readScriptAttributes(): ScriptAttributes | null {\n  if (typeof document === 'undefined') {\n    return null;\n  }\n\n  const script = findScriptElement();\n  if (!script) {\n    console.warn('[AACA Embed] Unable to locate embed script tag.');\n    return null;\n  }\n\n  const siteId = script.dataset['siteId'];\n  if (!siteId) {\n    console.warn('[AACA Embed] data-site-id is required on the embed script tag.');\n    return null;\n  }\n\n  return {\n    siteId,\n    embedKey: script.dataset['embedKey'],\n    apiBaseUrl: script.dataset['apiBaseUrl'] || DEFAULT_API_BASE,\n    skipLinkText: script.dataset['skipLinkText'],\n    focusOutlineColor: script.dataset['focusOutlineColor'],\n    disableAltText: coerceBooleanFlag(script.dataset['disableAltText']),\n    disableSkipLink: coerceBooleanFlag(script.dataset['disableSkipLink']),\n    disableFocusOutline: coerceBooleanFlag(script.dataset['disableFocusOutline']),\n  };\n}\n\nexport async function fetchEmbedConfig(\n  attributes: ScriptAttributes,\n  fetchImpl: typeof fetch = fetch\n): Promise<EmbedConfig | null> {\n  const baseUrl = attributes.apiBaseUrl || DEFAULT_API_BASE;\n  let endpoint: string;\n  try {\n    const url = new URL(baseUrl, window.location.origin);\n    url.pathname = `${url.pathname.replace(/\\/$/, '')}/sites/${encodeURIComponent(attributes.siteId)}/embed-config`;\n    endpoint = url.toString();\n  } catch (error) {\n    console.warn('[AACA Embed] Invalid apiBaseUrl; falling back to /api/v1.', error);\n    endpoint = `${DEFAULT_API_BASE}/sites/${encodeURIComponent(attributes.siteId)}/embed-config`;\n  }\n\n  try {\n    const response = await fetchImpl(endpoint, {\n      headers: attributes.embedKey ? { 'X-Embed-Key': attributes.embedKey } : undefined,\n    });\n\n    if (!response.ok) {\n      console.warn('[AACA Embed] Unable to fetch embed config:', response.status, response.statusText);\n      return null;\n    }\n\n    const config: EmbedConfig = await response.json();\n    return config;\n  } catch (error) {\n    console.warn('[AACA Embed] Failed to load embed config:', error);\n    return null;\n  }\n}\n\nexport function deriveFeatures(\n  config: EmbedConfig | null,\n  attributes: ScriptAttributes\n): FeatureToggles {\n  const fromConfig = {\n    altText: config?.autoFixes?.includes('alt_text'),\n    skipLink: config?.enableSkipLink ?? config?.autoFixes?.includes('skip_link'),\n    focusOutline: config?.autoFixes?.includes('focus_outline'),\n  };\n\n  const merged: FeatureToggles = {\n    altText: attributes.disableAltText ? false : fromConfig.altText ?? DEFAULT_FEATURES.altText,\n    skipLink: attributes.disableSkipLink ? false : fromConfig.skipLink ?? DEFAULT_FEATURES.skipLink,\n    focusOutline: attributes.disableFocusOutline ? false : fromConfig.focusOutline ?? DEFAULT_FEATURES.focusOutline,\n  };\n\n  return merged;\n}\n"],
  "mappings": "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",
  "names": []
}
